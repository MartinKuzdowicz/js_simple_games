<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>tic tac toe in js</title>

<script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
 <!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

<style type="text/css">

#kolko_krzyzyk_table, #kolko_krzyzyk_table td {
	border: 1px solid black;
}

#kolko_krzyzyk_table {
	width: 40%;
	height: 500px;
	margin: 0 100px 0 100px;
}

header {
	width: 80%;
	margin: 0 auto;
}

#kolko_krzyzyk_table td {
	cursor: pointer;
	margin: 0;
	padding: 0;
}

#startNewGameBtn {
	cursor: pointer;
}

#kolko_krzyzyk_table {
	border: none;
	width: 60%;
	margin: 0 auto;
}

#roundColor {
	width: 50px;
	height: 50px;
	background-color: red;
}

#roundwrapper {
	margin: 0 auto;
	width: 50%;
}


#ticTitle h1 {
	text-align: center;
}

</style>
</head>
<body>
<header>

<div id="ticTitle">
<h1>tic tac toe</h1>
</div>

</header>

<main class="container">

	<table id="kolko_krzyzyk_table">
		<tr>
			<td id="p1"></td>
			<td id="p2"></td>
			<td id="p3"></td>
		</tr>
	<tr>
			<td id="p4"></td>
			<td id="p5"></td>
			<td id="p6"></td>
		</tr>
		<tr>
			<td id="p7"></td>
			<td id="p8"></td>
			<td id="p9"></td>
		</tr>

	</table>

	<div id="roundwrapper"> 
	<h3>round: </h3> <div id="roundColor"></div>
	<br />
	<button class="btn btn-success" id="startNewGameBtn">star new game</button>

	</div>

	

</main>
<script type="text/javascript">

var COLOR_RED = 'red';
var COLOR_BLUE = 'blue';

var GAME_IS_OVER = false;

var userMoved = false;

var gameRound;

var p1;
var p2;
var p3;
var p4;
var p5;
var p6;
var p7;
var p8;
var p9;


var fields;


function initGame() {

	fields = ['n', 'n', 'n', 'n', 'n', 'n', 'n', 'n', 'n'];

	p1 = fields[0];
	p2 = fields[1];
	p3 = fields[2];
	p4 = fields[3];
	p5 = fields[4];
	p6 = fields[5];
	p7 = fields[6];
	p8 = fields[7];
	p9 = fields[8];

	gameRound = COLOR_RED;

	GAME_IS_OVER = false;

    userMoved = false;
}

function switchColor(){

	if(gameRound == COLOR_RED) {
		 gameRound = COLOR_BLUE;
	} else {
		gameRound = COLOR_RED
	}

	 $('#roundColor').css('background-color', gameRound);
}

function addColorToEventTarget(e) {

	var eventTarget = e.target;

	var id = eventTarget.id;
	console.log(eventTarget.id);

	$('#'+id).css('background-color', gameRound);
	$('#'+id).attr('disabled', true);

	setFieldVariabels(id, gameRound);

}

function addColorToTargetById(id) {


	$('#'+id).css('background-color', gameRound);
	$('#'+id).attr('disabled', true);

	setFieldVariabels(id, gameRound);

}

function setFieldVariabels(fieldName, color) {

	if(fieldName == 'p1') {
		p1 = color;
		fields[0] = color;
	}

	if(fieldName == 'p2') {
		p2 = color;
		fields[1] = color;
	}

	if(fieldName == 'p3') {
		p3 = color;
		fields[2] = color;
	}

	if(fieldName == 'p4') {
		p4 = color;
		fields[3] = color;
	}

	if(fieldName == 'p5') {
		p5 = color;
		fields[4] = color;
	}

	if(fieldName == 'p6') {
		p6 = color;
		fields[5] = color;
	}

	if(fieldName == 'p7') {
		p7 = color;
		fields[6] = color;
	}

	if(fieldName == 'p8') {
		p8 = color;
		fields[7] = color;
	}

	if(fieldName == 'p9') {
		p9 = color;
		fields[8] = color;
	}

}

function alertWinnerIfThereIsAWinner() {

	if(p1 == p2 && p2 == p3 && p1 != 'n') {

		GAME_IS_OVER = true;
		alert('winning color: '+p1);

	}

	if(p4 == p5 && p5 == p6 && p4 != 'n') {

		GAME_IS_OVER = true;
		alert('winning color: '+p4);

	}

	if(p7 == p8 && p8 == p9 && p7 != 'n') {

		GAME_IS_OVER = true;
		alert('winning color: '+p7);

	}

	if(p1 == p5 && p5 == p9 && p1 != 'n') {

		GAME_IS_OVER = true;
		alert('winning color: '+p1);

	}

	if(p7 == p5 && p5 == p3 && p7 != 'n') {

		GAME_IS_OVER = true;
		alert('winning color: '+p7);

	}

	if(p1 == p4 && p4 == p7 && p1 != 'n') {

		GAME_IS_OVER = true;
		alert('winning color: '+p1);

	}

	if(p2 == p5 && p5 == p8 && p2 != 'n') {

		GAME_IS_OVER = true;
		alert('winning color: '+p2);

	}

	if(p3 == p6 && p6 == p9 && p3 != 'n') {

		GAME_IS_OVER = true;
		alert('winning color: '+p3);

	}

}

function chceckIfFieldISSet(event) {

	var eventTargetElId = event.target.id;

	if(eventTargetElId == 'p1') {
		return chceckIFFieldIsSet(p1);
	}
	if(eventTargetElId == 'p2') {
		return chceckIFFieldIsSet(p2);
	}
	if(eventTargetElId == 'p3') {
		return chceckIFFieldIsSet(p3);
	}
	if(eventTargetElId == 'p4') {
		return chceckIFFieldIsSet(p4);
	}
	if(eventTargetElId == 'p5') {
		return chceckIFFieldIsSet(p5);
	}
	if(eventTargetElId == 'p6') {
		return chceckIFFieldIsSet(p6);
	}
	if(eventTargetElId == 'p7') {
		return chceckIFFieldIsSet(p7);
	}
	if(eventTargetElId == 'p8') {
		return chceckIFFieldIsSet(p8);
	}
	if(eventTargetElId == 'p9') {
		return chceckIFFieldIsSet(p9);
	}

}

function chceckIFFieldIsSet(filedVar) {

	if(filedVar != 'n') {
		return false;
	} else {
		return true;
	}

}



function play(e) {

		if(!userMoved) {

			var isNotset = chceckIfFieldISSet(e);

			if(isNotset) {

				addColorToEventTarget(e);
				switchColor();
				alertWinnerIfThereIsAWinner();

			}

			userMoved = true;

		} else {
			alert('wait for computer');
		}

	

		if(userMoved && !GAME_IS_OVER) {


			computerMove();
	
		}

	}


function computerMove() {

	setTimeout(function(){

	for(var i = 0; i < fields.length; i++) {

			if(fields[i] == 'n') {

				var id = 'p'+(i+1);

				addColorToTargetById(id);
				switchColor();
				break;
			}

		}

		userMoved = false;
		if(!GAME_IS_OVER) {
			alertWinnerIfThereIsAWinner();
		}
		

	}, 2000);

}

$(document).ready(function(){

	initGame();

	$('td').click(function(e, callback){
		play(e);

		

	});


	$('#startNewGameBtn').click(function(){

		var fieldsList = $('td');

		for(var i = 0; i < fieldsList.length; i++){

			var fieldId = fieldsList[i].id;

			$('#'+fieldId).css('background-color', '');
			$('#'+fieldId).attr('disabled', false);

		}

		initGame();
		$('#roundColor').css('background-color', gameRound);

	});


});

</script>
</body>
</html>